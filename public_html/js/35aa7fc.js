(function($,window,document,undefined){"use strict";Foundation.libs.section={name:"section",version:"4.2.3",settings:{deep_linking:false,small_breakpoint:200,one_up:true,section_selector:"[data-section]",region_selector:"section, .section, [data-section-region]",title_selector:".title, [data-section-title]",active_region_selector:"section.active, .section.active, .active[data-section-region]",content_selector:".content, [data-section-content]",nav_selector:'[data-section="vertical-nav"], [data-section="horizontal-nav"]',callback:function(){}},init:function(scope,method,options){var self=this;Foundation.inherit(this,"throttle data_options position_right offset_right");if(typeof method==="object"){$.extend(true,self.settings,method)}if(typeof method!=="string"){this.set_active_from_hash();this.events();return true}else{return this[method].call(this,options)}},events:function(){var self=this;$(this.scope).on("click.fndtn.section","[data-section] .title, [data-section] [data-section-title]",function(e){var $this=$(this),section=$this.closest(self.settings.region_selector);if(section.children(self.settings.content_selector).length>0){self.toggle_active.call(this,e,self);self.reflow()}});$(window).on("resize.fndtn.section",self.throttle(function(){self.resize.call(this)},30)).on("hashchange",function(){if(!self.settings.toggled){self.set_active_from_hash();$(this).trigger("resize")}}).trigger("resize");$(document).on("click.fndtn.section",function(e){if($(e.target).closest(self.settings.title_selector).length<1){$(self.settings.nav_selector).children(self.settings.region_selector).removeClass("active").attr("style","")}})},toggle_active:function(e,self){var $this=$(this),self=Foundation.libs.section,region=$this.closest(self.settings.region_selector),content=$this.siblings(self.settings.content_selector),parent=region.parent(),settings=$.extend({},self.settings,self.data_options(parent)),prev_active_section=parent.children(self.settings.active_region_selector);self.settings.toggled=true;if(!settings.deep_linking&&content.length>0){e.preventDefault()}if(region.hasClass("active")){if(self.small(parent)||self.is_vertical_nav(parent)||self.is_horizontal_nav(parent)||self.is_accordion(parent)){if(prev_active_section[0]!==region[0]||prev_active_section[0]===region[0]&&!settings.one_up){region.removeClass("active").attr("style","")}}}else{var prev_active_section=parent.children(self.settings.active_region_selector),title_height=self.outerHeight(region.children(self.settings.title_selector));if(self.small(parent)||settings.one_up){if(self.small(parent)){prev_active_section.attr("style","")}else{prev_active_section.attr("style","visibility: hidden; padding-top: "+title_height+"px;")}}if(self.small(parent)){region.attr("style","")}else{region.css("padding-top",title_height)}region.addClass("active");if(prev_active_section.length>0){prev_active_section.removeClass("active").attr("style","")}if(self.is_vertical_tabs(parent)){content.css("display","block");if(prev_active_section!==null){prev_active_section.children(self.settings.content_selector).css("display","none")}}}setTimeout(function(){self.settings.toggled=false},300);settings.callback()},resize:function(){var self=Foundation.libs.section,sections=$(self.settings.section_selector);sections.each(function(){var $this=$(this),active_section=$this.children(self.settings.active_region_selector),settings=$.extend({},self.settings,self.data_options($this));if(active_section.length>1){active_section.not(":first").removeClass("active").attr("style","")}else if(active_section.length<1&&!self.is_vertical_nav($this)&&!self.is_horizontal_nav($this)&&!self.is_accordion($this)){var first=$this.children(self.settings.region_selector).first();if(settings.one_up||!self.small($this)){first.addClass("active")}if(self.small($this)){first.attr("style","")}else{first.css("padding-top",self.outerHeight(first.children(self.settings.title_selector))-1)}}if(self.small($this)){active_section.attr("style","")}else{active_section.css("padding-top",self.outerHeight(active_section.children(self.settings.title_selector))-1)}self.position_titles($this);if(self.is_horizontal_nav($this)&&!self.small($this)||self.is_vertical_tabs($this)&&!self.small($this)){self.position_content($this)}else{self.position_content($this,false)}})},is_vertical_nav:function(el){return/vertical-nav/i.test(el.data("section"))},is_horizontal_nav:function(el){return/horizontal-nav/i.test(el.data("section"))},is_accordion:function(el){return/accordion/i.test(el.data("section"))},is_horizontal_tabs:function(el){return/^tabs$/i.test(el.data("section"))},is_vertical_tabs:function(el){return/vertical-tabs/i.test(el.data("section"))},set_active_from_hash:function(){var hash=window.location.hash.substring(1),sections=$("[data-section]"),self=this;sections.each(function(){var section=$(this),settings=$.extend({},self.settings,self.data_options(section));if(hash.length>0&&settings.deep_linking){var regions=section.children(self.settings.region_selector).attr("style","").removeClass("active");var hash_regions=regions.map(function(){var content=$(self.settings.content_selector,this),content_slug=content.data("slug");if(new RegExp(content_slug,"i").test(hash))return content});var count=hash_regions.length;for(var i=count-1;i>=0;i--){$(hash_regions[i]).parent().addClass("active")}}})},position_titles:function(section,off){var self=this,titles=section.children(this.settings.region_selector).map(function(){return $(this).children(self.settings.title_selector)}),previous_width=0,previous_height=0,self=this;if(typeof off==="boolean"){titles.attr("style","")}else{titles.each(function(){if(self.is_vertical_tabs(section)){$(this).css("top",previous_height);previous_height+=self.outerHeight($(this))}else{if(!self.rtl){$(this).css("left",previous_width)}else{$(this).css("right",previous_width)}previous_width+=self.outerWidth($(this))}})}},position_content:function(section,off){var self=this,regions=section.children(self.settings.region_selector),titles=regions.map(function(){return $(this).children(self.settings.title_selector)}),content=regions.map(function(){return $(this).children(self.settings.content_selector)});if(typeof off==="boolean"){content.attr("style","");section.attr("style","");content.css("minHeight","");content.css("maxWidth","")}else{if(self.is_vertical_tabs(section)&&!self.small(section)){var content_min_height=0,content_min_width=Number.MAX_VALUE,title_width=null;regions.each(function(){var region=$(this),title=region.children(self.settings.title_selector),content=region.children(self.settings.content_selector),content_width=0;title_width=self.outerWidth(title);content_width=self.outerWidth(section)-title_width;if(content_width<content_min_width){content_min_width=content_width}content_min_height+=self.outerHeight(title);if(!$(this).hasClass("active")){content.css("display","none")}});regions.each(function(){var content=$(this).children(self.settings.content_selector);content.css("minHeight",content_min_height);content.css("maxWidth",content_min_width-2)})}else{regions.each(function(){var region=$(this),title=region.children(self.settings.title_selector),content=region.children(self.settings.content_selector);if(!self.rtl){content.css({left:title.position().left-1,top:self.outerHeight(title)-2})}else{content.css({right:self.position_right(title)+1,top:self.outerHeight(title)-2})}});if(typeof Zepto==="function"){section.height(this.outerHeight($(titles[0])))}else{section.height(this.outerHeight($(titles[0]))-2)}}}},position_right:function(el){var self=this,section=el.closest(this.settings.section_selector),regions=section.children(this.settings.region_selector),section_width=el.closest(this.settings.section_selector).width(),offset=regions.map(function(){return $(this).children(self.settings.title_selector)}).length;return section_width-el.position().left-el.width()*(el.index()+1)-offset},reflow:function(scope){var scope=scope||document;$(this.settings.section_selector,scope).trigger("resize")},small:function(el){var settings=$.extend({},this.settings,this.data_options(el));if(this.is_horizontal_tabs(el)){return false}if(el&&this.is_accordion(el)){return true}if($("html").hasClass("lt-ie9")){return true}if($("html").hasClass("ie8compat")){return true}return $(this.scope).width()<settings.small_breakpoint},off:function(){$(this.scope).off(".fndtn.section");$(window).off(".fndtn.section");$(document).off(".fndtn.section")}}})(Foundation.zj,this,this.document);
(function($,window,document,undefined){"use strict";var Tabs={$container:$(".avatar-container"),$triggers:$("p[data-section-title]").find("a"),$content:null,$currentTabContent:null,init:function(){this.$triggers.on("click",this.loadPage)},loadPage:function(e){e.preventDefault();var url=$(this).attr("href");Tabs.$currentTabContent=$(this).parents("section").find(".content");Tabs.injectLoader();$.get(url,function(data){Tabs.$currentTabContent.html(data)})},injectLoader:function(){var loader=$('<div class="ajax-loader-inner"></div>');Tabs.$currentTabContent.hide().html(loader).fadeIn().css("display","")},reload:function(){Tabs.$container.find("section.active").find("p.title").find("a").click()}};Tabs.init();var Inventory={$container:$(".tab-inventario, .tab-vestiti, .tab-bag"),$parentTable:null,$currentTr:null,$currentItem:null,$sellUrl:null,init:function(){this.$container.on("click",".data-inventory-items",this.loadItems);this.$container.on("click",".checkbox-visibility",this.changeCheckbox);this.$container.on("click",".checkbox-equipped",this.changeCheckbox);this.$container.on("click",".sell-item",this.sellItem);this.$container.on("click",".send-item",this.sendItem);this.$container.on("click",".delete-item",this.deleteItem);this.$container.on("click",".radio-dressed",this.dressItem);this.$container.on("click",".page",this.loadPage);this.$container.on("click",".esamina-item",this.esaminaItem);$("body").on("submit",".avatar-send-item",this.sendItemForm)},esaminaItem:function(e){e.preventDefault();var $this=$(this);Popup.alert("medium","<p>Attendi...</p>");$.get($this.data("href"),function(data){Popup.refresh(data)})},loadPage:function(e){e.preventDefault();var url=$(this).attr("href");var $currentTBody=$(this).parents("table").first().find("tbody");var $currentTable=$(this).parents("table").first();var $this=$(this);Pending.init(true,$currentTable);$.get(url,function(data){$currentTBody.html(data);$currentTBody.find("th").parent().remove();$currentTable.find("a.close-category").removeClass("hide");$this.addClass("hide");Pending.init(false,$currentTable)})},loadItems:function(e){e.preventDefault();var url=$(this).attr("href");var $container=$(".js-inventory-items-container");var $this=$(this);Pending.init(true,$container);$.get(url,function(data){$container.html(data);Pending.init(false,$container);$(".item-box").matchHeight({byRow:false});window.setTimeout(function(){$.fn.matchHeight._update()},200)})},closeCategory:function(e){var $this=$(this);$(this).parents("table").first().find("tbody").empty();$this.addClass("hide");$this.parents("table").first().find(".data-inventory-items").removeClass("hide")},changeCheckbox:function(e){var $this=$(this);var url=$this.attr("data-url");var $currentTr=$this.parents("tr.item-row");Pending.init(true,$currentTr);$.get(url,function(data){Pending.init(false,$currentTr);if(data.response==false){Popup.alert("small",data.message)}if(data.value==true){$this.prop("checked","checked")}else{$this.removeAttr("checked")}})},dressItem:function(e){e.preventDefault();var $this=$(this);if($this.hasClass("selected")){return}$this.addClass("selected");var url=$this.attr("data-url");var $currentTr=$this.parents("tr.item-row");var $currentItem=$this.parents(".item-box");Pending.init(true,$currentTr);Pending.init(true,$currentItem);$.get(url,function(data){Pending.init(false,$currentTr);Pending.init(false,$currentItem);if(data.response==true){$(".radio-dressed").not($this).removeAttr("checked").removeClass("selected");Inventory.$container.find(".checkbox-visibility").removeAttr("disabled");Inventory.$container.find(".checkbox-equipped").removeAttr("disabled");var $checkVisibility=$currentTr.find(".checkbox-visibility");$checkVisibility.attr("disabled","disabled");$checkVisibility.removeAttr("checked");var $checkVisibility=$currentItem.find(".checkbox-visibility");$checkVisibility.attr("disabled","disabled");$checkVisibility.removeAttr("checked");var $checkEquipped=$currentTr.find(".checkbox-equipped");$checkEquipped.prop("checked","checked");$checkEquipped.attr("disabled","disabled");$this.prop("checked","checked");var $checkEquipped=$currentItem.find(".checkbox-equipped");$checkEquipped.prop("checked","checked");$checkEquipped.attr("disabled","disabled");$this.prop("checked","checked")}else{Popup.alert("small",data.message);$this.removeAttr("checked")}})},sellItem:function(){var $this=$(this);Inventory.$url=$this.attr("data-url");Inventory.$currentTr=$this.parents("tr.item-row");Inventory.$currentItem=$this.parents(".item-box");var confirm="<p>Se vendete questo oggetto avrete un guadagno pari alla metà del costo d'acquisto dello stesso. Volete procedere con la vendita?</p>";Popup.confirm("small",confirm,Inventory.doSellItem)},doSellItem:function(){Pending.init(true,Inventory.$currentTr);Pending.init(true,Inventory.$currentItem);$.getJSON(Inventory.$url,function(data){Popup.refresh(data.message);Pending.init(false,Inventory.$currentTr);Pending.init(false,Inventory.$currentItem);if(data.response){Inventory.$currentItem.remove()}})},deleteItem:function(){var $this=$(this);var $currentTr=$this.parents("tr.item-row");var $currentItem=$this.parents(".item-box");Popup.confirm("small","<p>Siete sicuro di voler distruggere definitivamente questo oggetto?</p>",function(){Pending.init(true,$currentTr);Pending.init(true,$currentItem);$.getJSON($this.attr("data-url"),function(data){Popup.refresh(data.message);Pending.init(false,$currentItem);Pending.init(false,$currentTr);if(data.response){$currentItem.remove();$currentTr.remove()}})})},sendItem:function(e){var $this=$(this);e.preventDefault();Popup.alert("small","<p>Attendi...</p>");$.get($this.data("url"),function(data){Popup.refresh(data)})},sendItemForm:function(e){e.preventDefault();var $form=$(this);$form.find(".msg").html("<p>Attendi...</p>");$form.ajaxSubmit({success:function(data){if(data.response){Popup.refresh("<p>"+data.message+"</p>");var $tr=$("#inventory-"+data.id);Pending.init(true,$tr);$tr.remove()}else{$form.find(".msg").html(data.message)}}})}};Inventory.init();var Bag={$container:$(".tab-bag"),init:function(){this.$container.on("click",".unequip-item",this.unequipItem)},unequipItem:function(e){var $this=$(this);var url=$this.attr("data-url");var $currentTr=$this.parents("tr.item-row");Pending.init(true,$currentTr);$.get(url,function(data){Pending.init(false,$currentTr);if(data.response){$currentTr.remove();Bag.$container.find(".actual-weight").html(data.totalWeight);var $totalItems=Bag.$container.find(".total-items");var oldTotalItems=parseInt(Bag.$container.find(".total-items").text());$totalItems.text(oldTotalItems-1)}else{Popup.alert("small",data.message)}})}};Bag.init();var Diary={$container:$(".tab-diary"),init:function(){this.$container.on("click",".page",this.loadPages);this.$container.on("click",".diary-show",this.loadOnePage);this.$container.on("submit","#diary-new-page",this.createPage);this.$container.on("click",".edit",this.edit);this.$container.on("click",".delete",this.remove)},loadPages:function(e){e.preventDefault();var $this=$(this);$.get($this.attr("href")+"&ajax=1",function(data){$("#diary-pages").html(data)})},loadOnePage:function(e){e.preventDefault();var $this=$(this);$.get($this.attr("href"),function(data){Popup.alert("medium",data)})},createPage:function(e){e.preventDefault();var $this=$(this);$.post($this.attr("action"),$this.serialize(),function(data){if(data.response){Tabs.reload()}Popup.alert("small",data.message);Diary.refreshList()})},edit:function(e){e.preventDefault();var $this=$(this);$.get($this.attr("href"),function(html){$(".diary-content-form").html(html)})},remove:function(e){e.preventDefault();var $this=$(this);Popup.confirm("small","<p>Siete sicuro di voler eliminare questa pagina?</p>",function(){$.post($this.attr("href"),function(data){Popup.refresh("<p>Avete cancellato correttamente la pagina.</p>");Diary.refreshList()})})},refreshList:function(){var route=Routing.generate("avatar-diary-list",{ajax:true});$.get(route,function(data){$("#diary-pages").html(data)})}};Diary.init();var Experience={$container:$(".tab-experience"),init:function(){this.$container.on("click",".isHidden",this.changeVisibility)},changeVisibility:function(e){var $this=$(this);var url=$this.attr("data-url");var $currentTr=$this.parents("tr.experience-row");Pending.init(true,$currentTr);$.get(url,function(data){if(data.value==true){$this.prop("checked","checked")}else{$this.removeAttr("checked")}Pending.init(false,$currentTr)})}};Experience.init();var Management={$container:$(".tab-management"),init:function(){this.$container.on("submit","#form-management-common",this.submitCommon);this.$container.on("submit","#form-management-user",this.submitUser);this.$container.on("click",".kill",this.killMySelf)},submitCommon:function(e){e.preventDefault();var $form=$(this);$(this).ajaxSubmit({success:function(data){if(data.response){Popup.alert("small","<p>"+data.message+"</p>")}else{Popup.alert("small","<p><strong>Attenzione!</strong> I dati non sono stati salvati perché:</p>"+Management.createErrorsView(data.message))}}})},submitUser:function(e){e.preventDefault();var $form=$(this);Popup.alert("small","<p>Attendi...</p>");$.post($form.attr("action"),$form.serialize(),function(data){if(data.response){Popup.alert("small",data.message);$form.find("#user_plainPassword_first, #user_plainPassword_second").val("")}else{Popup.alert("small","<p><strong>Attenzione!</strong> I dati non sono stati salvati perché:</p> "+Management.createErrorsView(data.message))}})},createErrorsView:function(errors){var items="<ul>";$.each(errors,function(key,val){items=items+"<li>"+val+"</li>"});items=items+"</ul>";return items},killMySelf:function(){var $this=$(this);var msg="<p>Sei sicuro di voler dichiarare la morte del tuo pg? L'azione non è reversibile e dovrai "+"attendere 7 o 21 giorni, a seconda del caso, per tornare in vita. Riceverai una missiva che ti "+"confermerà l'avvenuta morte.</p>";Popup.confirm("small",msg,function(){$.get($this.data("href"),function(){location.reload()})})}};Management.init();var Grimory={$container:$(".tab-grimory"),init:function(){this.$container.on("click",".open-categories, .loadContainer",this.loadInContainer);this.$container.on("click",".show-spells, .page",this.loadSpells);this.$container.on("click",".selectSpell",this.changeSpell);this.$container.on("click",".study",this.studySpells);this.$container.on("click",".show-spell-description",this.showSpellDescription)},loadInContainer:function(e){e.preventDefault();Grimory.$container.load($(this).attr("href"))},loadSpells:function(e){e.preventDefault();var url=$(this).attr("href");var $currentTBody=$(this).parents("tbody");var $currentTable=$(this).parents(".table-categories");Pending.init(true,$currentTable);$.get(url,function(data){$currentTBody.html(data);Pending.init(false,$currentTable)})},changeSpell:function(){var $this=$(this);var url=$this.attr("data-url");var $currentTr=$this.parents("tr.spell-row");Pending.init(true,$currentTr);$.getJSON(url,function(data){Pending.init(false,$currentTr);Popup.alert("small","<p>"+data.message+"</p>");if(data.value==true){$this.prop("checked","checked")}else{$this.removeAttr("checked")}})},studySpells:function(e){e.preventDefault();var $this=$(this),msg="<p>Siete sicuro di voler studiare gli incantesimi selezionati? Non potrete più farlo fino al prossimo sorgere del sole [ore 5.00 am].</p>";Popup.confirm("small",msg,function(){$.getJSON($this.attr("href"),function(data){if(data.response){Tabs.$container.find("section.active").find("p.title").find("a").click();Popup.close()}else{Popup.alert("small",data.message)}})})},showSpellDescription:function(e){e.preventDefault();var $this=$(this);$.get($this.attr("href"),function(data){Popup.alert("small",data)})}};Grimory.init();var Skill={$container:$(".tab-skill"),init:function(){this.$container.on("click",".can-learn",this.learn);this.$container.on("click",".can-learn-random",this.learnRandom)},learn:function(e){e.preventDefault();var $this=$(this);var msg="<p>Siete sicuro di voler imparare questa skill? La scelta, per questo livello, è definitiva.</p>";Popup.confirm("small",msg,function(){Popup.refresh("<p>Attendi...</p>");$.get($this.attr("href"),function(){Tabs.reload();Popup.close()})})},learnRandom:function(e){e.preventDefault();var $this=$(this);var price=$this.data("price");var msg="<p>Attenzione! Bevendo questa pozione (costo "+price+" Mori) il tuo Personaggio otterrà una nuova Skill! Il risultato è del tutto casuale oltre che definitivo.</p>";Popup.confirm("small",msg,function(){Popup.refresh("<p>Attendi...</p>");$.get($this.attr("data-href"),function(data){if(data.success==true){Tabs.reload()}Popup.refresh("<p>"+data.message+"</p>")})})}};Skill.init();var Property={$container:$(".tab-property"),init:function(){this.$container.on("click","input:checkbox",this.changeAddress);this.$container.on("click",".sell",this.sell);this.$container.on("click",".show-items",this.showItems);this.$container.on("click",".crea-chiavi",this.createKeys);this.$container.on("click",".mostra-chiavi",this.showKeys);$(document).on("click",".remove-key-property",this.removeKey)},changeAddress:function(e){var $this=$(this);e.preventDefault();var $currentTable=$this.parents("tr");Pending.init(true,$currentTable);$.getJSON($this.data("href"),function(data){Property.$container.find("input:checkbox").prop("checked",!data.checkbox);$this.prop("checked",data.checkbox);Pending.init(false,$currentTable)})},sell:function(e){var $this=$(this);e.preventDefault();var $currentRow=$this.parents("tr").first();var $currentTable=$this.parents("table").first();Popup.confirm("small","<p>Sei sicuro di voler vendere questo immobile alla metà del suo prezzo originario?</p>",function(){Popup.refresh("<p>Attendi, l'Erario sta preparando i documenti...</p>");$.getJSON($this.data("href"),function(data){if(data.response){$currentRow.remove();Popup.refresh("<p>La vendita è andata a buon fine ed i Mori sono stati accreditati nel tuo conto bancario.</p>");Tabs.reload()}})})},showItems:function(e){var $this=$(this);e.preventDefault();Popup.alert("large","<p>Attendi...</p>");$.get($this.data("href"),function(data){Popup.alert("large",data)})},createKeys:function(e){var $this=$(this);e.preventDefault();var msg="<p>Con questa funzione verranno create e caricate automaticamente nell'inventario tutte le "+"chiavi disponibili a seconda del numero di inquili dell'alloggio.<br>Queste chiavi potranno essere "+"assegnate a qualsiasi personaggio ed allo stesso tempo potranno essere tolte in qualsiasi momento.</p>";Popup.confirm("small",msg,function(){$.get($this.data("href"),function(data){if(data.response){Tabs.reload();Popup.close()}else{Popup.refresh("<p>"+data.msg+"</p>")}})})},showKeys:function(e){var $this=$(this);e.preventDefault();Popup.alert("small","<p>Caricamento...</p>");$.get($this.data("href"),function(data){Popup.refresh(data)})},removeKey:function(e){var $this=$(this);e.preventDefault();$.get($this.data("href"),function(data){if(data.response){$this.closest("tr").hide()}})}};Property.init();var Combat={$container:$(".tab-combat"),init:function(){Combat.$container.on("click","[data-upgrade]",Combat.upgrade)},upgrade:function(e){e.preventDefault();var $this=$(this);Popup.confirm("small","<p>Sei sicuro di voler aumentare questo Set Combattente?</p>",function(){Popup.refresh("<p>Attendi...</p>");$.getJSON($this.data("href"),function(data){if(data.response){Popup.refresh("<p>"+data.msg+"</p>");Tabs.reload()}else{Popup.refresh("<p>"+data.msg+"</p>")}})})}};Combat.init()})(jQuery,window,document);